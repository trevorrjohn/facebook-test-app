buildscript {
  repositories {
    jcenter()
    mavenLocal()
    mavenCentral()
  }

  dependencies {
    classpath 'me.champeau.gradle:gradle-groovy-android-plugin:0.2.1'
    classpath 'com.android.tools.build:gradle:0.10.+'
    classpath 'org.robolectric.gradle:gradle-android-test-plugin:0.10.+'
  }
}

allprojects {
  repositories {
    mavenCentral()
  }
}

apply plugin: 'android'
apply plugin: 'me.champeau.gradle.groovy-android'
apply plugin: 'android-test'

android {
  packagingOptions {
    exclude 'LICENSE.txt'
    exclude 'META-INF/LICENSE'
    exclude 'META-INF/LICENSE.txt'
    exclude 'META-INF/NOTICE'
  }
  compileSdkVersion 19
  buildToolsVersion "19.0.3"

  defaultConfig {
    minSdkVersion 18
    targetSdkVersion 18
    versionCode 1
    versionName "1.0.0-SNAPSHOT"
  }
  buildTypes {
    release {
      runProguard false
    }
  }

  sourceSets {
    androidTest {
      setRoot('src/test')
    }
  }
}

androidTest {
  include '**/*Test.class'
}

dependencies {
  repositories {
    mavenCentral()
    maven {
      url 'https://oss.sonatype.org/content/repositories/snapshots/'
    }
  }

  // Groovy!
  compile 'org.codehaus.groovy:groovy:2.4.0-beta-1:grooid'

  androidTestCompile 'com.google.guava:guava:14.0.1'
  androidTestCompile 'junit:junit:4.11'
  androidTestCompile('org.robolectric:robolectric:2.3') {
    exclude module: 'classworlds'
    exclude module: 'maven-artifact'
    exclude module: 'maven-artifact-manager'
    exclude module: 'maven-error-diagnostics'
    exclude module: 'maven-model'
    exclude module: 'maven-plugin-registry'
    exclude module: 'maven-profile'
    exclude module: 'maven-project'
    exclude module: 'maven-settings'
    exclude module: 'nekohtml'
    exclude module: 'plexus-container-default'
    exclude module: 'plexus-interpolation'
    exclude module: 'plexus-utils'
    exclude module: 'wagon-file'
    exclude module: 'wagon-http-lightweight'
    exclude module: 'wagon-http-shared'
    exclude module: 'wagon-provider-api'
  }
  androidTestCompile 'com.squareup:fest-android:1.0.+'
  androidTestCompile 'com.'
}

apply plugin: 'idea'

idea {
  module {
    testOutputDir = file('build/test-classes/debug')
  }
}

if (System.getProperty("intellij")) {
  def script = file("scripts/fix_intellij_dependencies.sh")
  script.toString().execute()
}